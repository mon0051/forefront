{"version":3,"sources":["jsonp_backend.js"],"names":[],"mappings":"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","file":"jsonp_backend-compiled.js","sourcesContent":["/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\"use strict\";\nvar __extends = (this && this.__extends) || function (d, b) {\n    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    function __() { this.constructor = d; }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n};\nvar core_1 = require('@angular/core');\nvar Observable_1 = require('rxjs/Observable');\nvar base_response_options_1 = require('../base_response_options');\nvar enums_1 = require('../enums');\nvar exceptions_1 = require('../facade/exceptions');\nvar lang_1 = require('../facade/lang');\nvar interfaces_1 = require('../interfaces');\nvar static_response_1 = require('../static_response');\nvar browser_jsonp_1 = require('./browser_jsonp');\nvar JSONP_ERR_NO_CALLBACK = 'JSONP injected script did not invoke callback.';\nvar JSONP_ERR_WRONG_METHOD = 'JSONP requests must use GET request method.';\n/**\n * Abstract base class for an in-flight JSONP request.\n *\n * @experimental\n */\nvar JSONPConnection = (function () {\n    function JSONPConnection() {\n    }\n    return JSONPConnection;\n}());\nexports.JSONPConnection = JSONPConnection;\nvar JSONPConnection_ = (function (_super) {\n    __extends(JSONPConnection_, _super);\n    function JSONPConnection_(req, _dom, baseResponseOptions) {\n        var _this = this;\n        _super.call(this);\n        this._dom = _dom;\n        this.baseResponseOptions = baseResponseOptions;\n        this._finished = false;\n        if (req.method !== enums_1.RequestMethod.Get) {\n            throw exceptions_1.makeTypeError(JSONP_ERR_WRONG_METHOD);\n        }\n        this.request = req;\n        this.response = new Observable_1.Observable(function (responseObserver) {\n            _this.readyState = enums_1.ReadyState.Loading;\n            var id = _this._id = _dom.nextRequestID();\n            _dom.exposeConnection(id, _this);\n            // Workaround Dart\n            // url = url.replace(/=JSONP_CALLBACK(&|$)/, `generated method`);\n            var callback = _dom.requestCallback(_this._id);\n            var url = req.url;\n            if (url.indexOf('=JSONP_CALLBACK&') > -1) {\n                url = lang_1.StringWrapper.replace(url, '=JSONP_CALLBACK&', \"=\" + callback + \"&\");\n            }\n            else if (url.lastIndexOf('=JSONP_CALLBACK') === url.length - '=JSONP_CALLBACK'.length) {\n                url = url.substring(0, url.length - '=JSONP_CALLBACK'.length) + (\"=\" + callback);\n            }\n            var script = _this._script = _dom.build(url);\n            var onLoad = function (event) {\n                if (_this.readyState === enums_1.ReadyState.Cancelled)\n                    return;\n                _this.readyState = enums_1.ReadyState.Done;\n                _dom.cleanup(script);\n                if (!_this._finished) {\n                    var responseOptions_1 = new base_response_options_1.ResponseOptions({ body: JSONP_ERR_NO_CALLBACK, type: enums_1.ResponseType.Error, url: url });\n                    if (lang_1.isPresent(baseResponseOptions)) {\n                        responseOptions_1 = baseResponseOptions.merge(responseOptions_1);\n                    }\n                    responseObserver.error(new static_response_1.Response(responseOptions_1));\n                    return;\n                }\n                var responseOptions = new base_response_options_1.ResponseOptions({ body: _this._responseData, url: url });\n                if (lang_1.isPresent(_this.baseResponseOptions)) {\n                    responseOptions = _this.baseResponseOptions.merge(responseOptions);\n                }\n                responseObserver.next(new static_response_1.Response(responseOptions));\n                responseObserver.complete();\n            };\n            var onError = function (error) {\n                if (_this.readyState === enums_1.ReadyState.Cancelled)\n                    return;\n                _this.readyState = enums_1.ReadyState.Done;\n                _dom.cleanup(script);\n                var responseOptions = new base_response_options_1.ResponseOptions({ body: error.message, type: enums_1.ResponseType.Error });\n                if (lang_1.isPresent(baseResponseOptions)) {\n                    responseOptions = baseResponseOptions.merge(responseOptions);\n                }\n                responseObserver.error(new static_response_1.Response(responseOptions));\n            };\n            script.addEventListener('load', onLoad);\n            script.addEventListener('error', onError);\n            _dom.send(script);\n            return function () {\n                _this.readyState = enums_1.ReadyState.Cancelled;\n                script.removeEventListener('load', onLoad);\n                script.removeEventListener('error', onError);\n                if (lang_1.isPresent(script)) {\n                    _this._dom.cleanup(script);\n                }\n            };\n        });\n    }\n    JSONPConnection_.prototype.finished = function (data) {\n        // Don't leak connections\n        this._finished = true;\n        this._dom.removeConnection(this._id);\n        if (this.readyState === enums_1.ReadyState.Cancelled)\n            return;\n        this._responseData = data;\n    };\n    return JSONPConnection_;\n}(JSONPConnection));\nexports.JSONPConnection_ = JSONPConnection_;\n/**\n * A {@link ConnectionBackend} that uses the JSONP strategy of making requests.\n *\n * @experimental\n */\nvar JSONPBackend = (function (_super) {\n    __extends(JSONPBackend, _super);\n    function JSONPBackend() {\n        _super.apply(this, arguments);\n    }\n    return JSONPBackend;\n}(interfaces_1.ConnectionBackend));\nexports.JSONPBackend = JSONPBackend;\nvar JSONPBackend_ = (function (_super) {\n    __extends(JSONPBackend_, _super);\n    function JSONPBackend_(_browserJSONP, _baseResponseOptions) {\n        _super.call(this);\n        this._browserJSONP = _browserJSONP;\n        this._baseResponseOptions = _baseResponseOptions;\n    }\n    JSONPBackend_.prototype.createConnection = function (request) {\n        return new JSONPConnection_(request, this._browserJSONP, this._baseResponseOptions);\n    };\n    /** @nocollapse */\n    JSONPBackend_.decorators = [\n        { type: core_1.Injectable },\n    ];\n    /** @nocollapse */\n    JSONPBackend_.ctorParameters = [\n        { type: browser_jsonp_1.BrowserJsonp, },\n        { type: base_response_options_1.ResponseOptions, },\n    ];\n    return JSONPBackend_;\n}(JSONPBackend));\nexports.JSONPBackend_ = JSONPBackend_;\n//# sourceMappingURL=jsonp_backend.js.map"]}